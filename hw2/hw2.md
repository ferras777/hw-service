# Домашнее задание: Тестирование сервиса обработки данных #2
### Цель задания
* На основе кода из предыдущего домашнего задания вынести логику для работы с кафкой, бд и реализовать необходимые методы(отправка, получение, ожидание...), которые будут использоваться в тестах.
* Реализовать отправку сообщений в топики для любых сообщений независимо от их типа.
* Реализовать логику для генерации тестовых данных(для сообщений `market_event` и `market_report`, отправляемых в топик `markets`) и конвертации их в ожидаемые результаты(данные из таблицы `market_data` и сообщений, получаемых из `procesed_markets` топика) на основе предоставленной информации. При работе со списками рекомендуется использовать StreamAPI.
* [JUnit Extensions](https://docs.junit.org/current/user-guide/#extensions). Реализовать два расширения, которые будут выполняться перед каждым тестом - для очистки данных в топиках и очистки таблицы БД.
* Реализовать методы проверки для пообъектного сравнения, используя библиотеку [JSON Unit Fluent](https://mvnrepository.com/artifact/net.javacrumbs.json-unit/json-unit-fluent).
* Добавить параметризованные тесты, в которых будут отправляться рынки с одинаковыми статусами исходов. Необходимо проверить обработку сообщений `market_event` и `market_report` при всех возможных статусах.

#### Генерация тестовых данных
В предоставленном файле находится массив рынков и с их названиями(`name`), идентификаторами(`market_type_id`) и идентификаторами исходов(`selections_ids`):
```
...
{
  "name": "Match winner",
  "market_type_id": 2001,
  "selections_ids": [1, 2]
}
...
```
Информацию об идентификаторах следует использовать при генерации обоих типов сообщений.

```
      {
      ...
       "message_type": "market_report",
        "markets": [{
                "selections": [{
                        "status": "active",
                        "selection_type_id": 2
                    }, {
                        "status": "disabled",
                        "selection_type_id": 3
                    }
                ],
                "market_type_id": 1
            },
          ...
         ]
      }
      ...
```
```
      {
      ...
       "message_type": "market_event",
        "markets": [{
                ...
                "selections": [{
                        "status": 1,
                        "odds": {
                            "price": 2.4,
                            "probability": 0.55555
                        },
                        "selection_type_id": 1
                    }, {
                        "status": 1,
                        "odds": {
                            "price": 4.7,
                            "probability": 0.8888
                        },
                        "selection_type_id": 2
                    }
                ],
                "market_type_id": 1
            },
            ...
        ]
      }
```
При этом для `market_event` в полях `price` необходимо использовать рандомное число с плавающей запятой в диапазоне **1.5 - 10.5**, а для полей `probability` - рандомное число с плавающей запятой в диапазоне **0.01 - 0.99**.  
Объекты `specifiers` могут иметь в качестве `name` рандомную строку, `value` - рандомное число с плавающей запятой.  
Поле `status` может также иметь рандомный статус(если в задании не задано конкретное для этого условие) из списка возможных, описанных в документе с информацией о сервисе

### Критерии выполнения
* Организованная структура проекта, логичное разделение на классы и методы.
* Выполнены все пункты задания:
  * Реализованы и использованы в тестах методы для взаимодействия с кафкой и бд. Для кафки используется универсальный для всех типов сообщений метод отправки.
  * Реализован генератор тестовых данных и использован в тестах.
  * Требуемые расширения JUnit используются в тестах.
  * Используются методы для пообъектного сравнения результатов в тестах. 
* Реализованы тесты: 
  * на проверку обработки двух видов входных сообщений(из прошлого домашнего задания);
  * на проверку обработки сообщений с некорректным содержанием(из прошлого домашнего задания);
  * параметризованные, описанные в целях задания.